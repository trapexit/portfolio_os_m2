
/******************************************************************************
**
**  @(#) plane.c 96/08/27 1.3
**  $Id: plane.c,v 1.7 1995/01/16 19:48:35 vertex Exp $
**
******************************************************************************/


/*
** Test module for physical model of plane for E3 demo.
**
** Graphics ripped from lines.c
**
** Author: phil Burk
** Copyright 1995 3DO
** All Rights Reserved
*/

#include "types.h"
#include "event.h"
#include "stdio.h"
#include "graphics.h"
#include "math.h"
#include "audio.h"

#define PRT(x)  { printf x ; }
#define DBUG(x)  /* PRT(x) */


/*******************************************************************/
/*************** Sine Calculation **********************************/
/*******************************************************************/
/*
** This is needed because the existing EAS sin() is flaky!
*/
#define PI (3.141592653590)
#define PIx2 (PI * 2.0)
/* Sine wave table. */
#define NUM_SINE_ENTRIES 1024
static float gSineTable[] =
{
      0.0000000000,   0.0061358846,   0.0122715383,   0.0184067299, 
      0.0245412285,   0.0306748032,   0.0368072229,   0.0429382569, 
      0.0490676743,   0.0551952443,   0.0613207363,   0.0674439196, 
      0.0735645636,   0.0796824380,   0.0857973123,   0.0919089565, 
      0.0980171403,   0.1041216339,   0.1102222073,   0.1163186309, 
      0.1224106752,   0.1284981108,   0.1345807085,   0.1406582393, 
      0.1467304745,   0.1527971853,   0.1588581433,   0.1649131205, 
      0.1709618888,   0.1770042204,   0.1830398880,   0.1890686641, 
      0.1950903220,   0.2011046348,   0.2071113762,   0.2131103199, 
      0.2191012402,   0.2250839114,   0.2310581083,   0.2370236060, 
      0.2429801799,   0.2489276057,   0.2548656596,   0.2607941179, 
      0.2667127575,   0.2726213554,   0.2785196894,   0.2844075372, 
      0.2902846773,   0.2961508882,   0.3020059493,   0.3078496400, 
      0.3136817404,   0.3195020308,   0.3253102922,   0.3311063058, 
      0.3368898534,   0.3426607173,   0.3484186802,   0.3541635254, 
      0.3598950365,   0.3656129978,   0.3713171940,   0.3770074102, 
      0.3826834324,   0.3883450467,   0.3939920401,   0.3996241998, 
      0.4052413140,   0.4108431711,   0.4164295601,   0.4220002708, 
      0.4275550934,   0.4330938189,   0.4386162385,   0.4441221446, 
      0.4496113297,   0.4550835871,   0.4605387110,   0.4659764958, 
      0.4713967368,   0.4767992301,   0.4821837721,   0.4875501601, 
      0.4928981922,   0.4982276670,   0.5035383837,   0.5088301425, 
      0.5141027442,   0.5193559902,   0.5245896827,   0.5298036247, 
      0.5349976199,   0.5401714727,   0.5453249884,   0.5504579729, 
      0.5555702330,   0.5606615762,   0.5657318108,   0.5707807459, 
      0.5758081914,   0.5808139581,   0.5857978575,   0.5907597019, 
      0.5956993045,   0.6006164794,   0.6055110414,   0.6103828063, 
      0.6152315906,   0.6200572118,   0.6248594881,   0.6296382389, 
      0.6343932842,   0.6391244449,   0.6438315429,   0.6485144010, 
      0.6531728430,   0.6578066933,   0.6624157776,   0.6669999223, 
      0.6715589548,   0.6760927036,   0.6806009978,   0.6850836678, 
      0.6895405447,   0.6939714609,   0.6983762494,   0.7027547445, 
      0.7071067812,   0.7114321957,   0.7157308253,   0.7200025080, 
      0.7242470830,   0.7284643904,   0.7326542717,   0.7368165689, 
      0.7409511254,   0.7450577854,   0.7491363945,   0.7531867990, 
      0.7572088465,   0.7612023855,   0.7651672656,   0.7691033376, 
      0.7730104534,   0.7768884657,   0.7807372286,   0.7845565972, 
      0.7883464276,   0.7921065773,   0.7958369046,   0.7995372691, 
      0.8032075315,   0.8068475535,   0.8104571983,   0.8140363297, 
      0.8175848132,   0.8211025150,   0.8245893028,   0.8280450453, 
      0.8314696123,   0.8348628750,   0.8382247056,   0.8415549774, 
      0.8448535652,   0.8481203448,   0.8513551931,   0.8545579884, 
      0.8577286100,   0.8608669386,   0.8639728561,   0.8670462455, 
      0.8700869911,   0.8730949784,   0.8760700942,   0.8790122264, 
      0.8819212643,   0.8847970984,   0.8876396204,   0.8904487232, 
      0.8932243012,   0.8959662498,   0.8986744657,   0.9013488470, 
      0.9039892931,   0.9065957045,   0.9091679831,   0.9117060320, 
      0.9142097557,   0.9166790599,   0.9191138517,   0.9215140393, 
      0.9238795325,   0.9262102421,   0.9285060805,   0.9307669611, 
      0.9329927988,   0.9351835099,   0.9373390119,   0.9394592236, 
      0.9415440652,   0.9435934582,   0.9456073254,   0.9475855910, 
      0.9495281806,   0.9514350210,   0.9533060404,   0.9551411683, 
      0.9569403357,   0.9587034749,   0.9604305194,   0.9621214043, 
      0.9637760658,   0.9653944417,   0.9669764710,   0.9685220943, 
      0.9700312532,   0.9715038910,   0.9729399522,   0.9743393828, 
      0.9757021300,   0.9770281427,   0.9783173707,   0.9795697657, 
      0.9807852804,   0.9819638691,   0.9831054874,   0.9842100924, 
      0.9852776424,   0.9863080972,   0.9873014182,   0.9882575677, 
      0.9891765100,   0.9900582103,   0.9909026354,   0.9917097537, 
      0.9924795346,   0.9932119492,   0.9939069700,   0.9945645707, 
      0.9951847267,   0.9957674145,   0.9963126122,   0.9968202993, 
      0.9972904567,   0.9977230666,   0.9981181129,   0.9984755806, 
      0.9987954562,   0.9990777278,   0.9993223846,   0.9995294175, 
      0.9996988187,   0.9998305818,   0.9999247018,   0.9999811753, 
      1.0000000000,   0.9999811753,   0.9999247018,   0.9998305818, 
      0.9996988187,   0.9995294175,   0.9993223846,   0.9990777278, 
      0.9987954562,   0.9984755806,   0.9981181129,   0.9977230666, 
      0.9972904567,   0.9968202993,   0.9963126122,   0.9957674145, 
      0.9951847267,   0.9945645707,   0.9939069700,   0.9932119492, 
      0.9924795346,   0.9917097537,   0.9909026354,   0.9900582103, 
      0.9891765100,   0.9882575677,   0.9873014182,   0.9863080972, 
      0.9852776424,   0.9842100924,   0.9831054874,   0.9819638691, 
      0.9807852804,   0.9795697657,   0.9783173707,   0.9770281427, 
      0.9757021300,   0.9743393828,   0.9729399522,   0.9715038910, 
      0.9700312532,   0.9685220943,   0.9669764710,   0.9653944417, 
      0.9637760658,   0.9621214043,   0.9604305194,   0.9587034749, 
      0.9569403357,   0.9551411683,   0.9533060404,   0.9514350210, 
      0.9495281806,   0.9475855910,   0.9456073254,   0.9435934582, 
      0.9415440652,   0.9394592236,   0.9373390119,   0.9351835099, 
      0.9329927988,   0.9307669611,   0.9285060805,   0.9262102421, 
      0.9238795325,   0.9215140393,   0.9191138517,   0.9166790599, 
      0.9142097557,   0.9117060320,   0.9091679831,   0.9065957045, 
      0.9039892931,   0.9013488470,   0.8986744657,   0.8959662498, 
      0.8932243012,   0.8904487232,   0.8876396204,   0.8847970984, 
      0.8819212643,   0.8790122264,   0.8760700942,   0.8730949784, 
      0.8700869911,   0.8670462455,   0.8639728561,   0.8608669386, 
      0.8577286100,   0.8545579884,   0.8513551931,   0.8481203448, 
      0.8448535652,   0.8415549774,   0.8382247056,   0.8348628750, 
      0.8314696123,   0.8280450453,   0.8245893028,   0.8211025150, 
      0.8175848132,   0.8140363297,   0.8104571983,   0.8068475535, 
      0.8032075315,   0.7995372691,   0.7958369046,   0.7921065773, 
      0.7883464276,   0.7845565972,   0.7807372286,   0.7768884657, 
      0.7730104534,   0.7691033376,   0.7651672656,   0.7612023855, 
      0.7572088465,   0.7531867990,   0.7491363945,   0.7450577854, 
      0.7409511254,   0.7368165689,   0.7326542717,   0.7284643904, 
      0.7242470830,   0.7200025080,   0.7157308253,   0.7114321957, 
      0.7071067812,   0.7027547445,   0.6983762494,   0.6939714609, 
      0.6895405447,   0.6850836678,   0.6806009978,   0.6760927036, 
      0.6715589548,   0.6669999223,   0.6624157776,   0.6578066933, 
      0.6531728430,   0.6485144010,   0.6438315429,   0.6391244449, 
      0.6343932842,   0.6296382389,   0.6248594881,   0.6200572118, 
      0.6152315906,   0.6103828063,   0.6055110414,   0.6006164794, 
      0.5956993045,   0.5907597019,   0.5857978575,   0.5808139581, 
      0.5758081914,   0.5707807459,   0.5657318108,   0.5606615762, 
      0.5555702330,   0.5504579729,   0.5453249884,   0.5401714727, 
      0.5349976199,   0.5298036247,   0.5245896827,   0.5193559902, 
      0.5141027442,   0.5088301425,   0.5035383837,   0.4982276670, 
      0.4928981922,   0.4875501601,   0.4821837721,   0.4767992301, 
      0.4713967368,   0.4659764958,   0.4605387110,   0.4550835871, 
      0.4496113297,   0.4441221446,   0.4386162385,   0.4330938189, 
      0.4275550934,   0.4220002708,   0.4164295601,   0.4108431711, 
      0.4052413140,   0.3996241998,   0.3939920401,   0.3883450467, 
      0.3826834324,   0.3770074102,   0.3713171940,   0.3656129978, 
      0.3598950365,   0.3541635254,   0.3484186802,   0.3426607173, 
      0.3368898534,   0.3311063058,   0.3253102922,   0.3195020308, 
      0.3136817404,   0.3078496400,   0.3020059493,   0.2961508882, 
      0.2902846773,   0.2844075372,   0.2785196894,   0.2726213554, 
      0.2667127575,   0.2607941179,   0.2548656596,   0.2489276057, 
      0.2429801799,   0.2370236060,   0.2310581083,   0.2250839114, 
      0.2191012402,   0.2131103199,   0.2071113762,   0.2011046348, 
      0.1950903220,   0.1890686641,   0.1830398880,   0.1770042204, 
      0.1709618888,   0.1649131205,   0.1588581433,   0.1527971853, 
      0.1467304745,   0.1406582393,   0.1345807085,   0.1284981108, 
      0.1224106752,   0.1163186309,   0.1102222073,   0.1041216339, 
      0.0980171403,   0.0919089565,   0.0857973123,   0.0796824380, 
      0.0735645636,   0.0674439196,   0.0613207363,   0.0551952443, 
      0.0490676743,   0.0429382569,   0.0368072229,   0.0306748032, 
      0.0245412285,   0.0184067299,   0.0122715383,   0.0061358846, 
      0.0000000000,  -0.0061358846,  -0.0122715383,  -0.0184067299, 
     -0.0245412285,  -0.0306748032,  -0.0368072229,  -0.0429382569, 
     -0.0490676743,  -0.0551952443,  -0.0613207363,  -0.0674439196, 
     -0.0735645636,  -0.0796824380,  -0.0857973123,  -0.0919089565, 
     -0.0980171403,  -0.1041216339,  -0.1102222073,  -0.1163186309, 
     -0.1224106752,  -0.1284981108,  -0.1345807085,  -0.1406582393, 
     -0.1467304745,  -0.1527971853,  -0.1588581433,  -0.1649131205, 
     -0.1709618888,  -0.1770042204,  -0.1830398880,  -0.1890686641, 
     -0.1950903220,  -0.2011046348,  -0.2071113762,  -0.2131103199, 
     -0.2191012402,  -0.2250839114,  -0.2310581083,  -0.2370236060, 
     -0.2429801799,  -0.2489276057,  -0.2548656596,  -0.2607941179, 
     -0.2667127575,  -0.2726213554,  -0.2785196894,  -0.2844075372, 
     -0.2902846773,  -0.2961508882,  -0.3020059493,  -0.3078496400, 
     -0.3136817404,  -0.3195020308,  -0.3253102922,  -0.3311063058, 
     -0.3368898534,  -0.3426607173,  -0.3484186802,  -0.3541635254, 
     -0.3598950365,  -0.3656129978,  -0.3713171940,  -0.3770074102, 
     -0.3826834324,  -0.3883450467,  -0.3939920401,  -0.3996241998, 
     -0.4052413140,  -0.4108431711,  -0.4164295601,  -0.4220002708, 
     -0.4275550934,  -0.4330938189,  -0.4386162385,  -0.4441221446, 
     -0.4496113297,  -0.4550835871,  -0.4605387110,  -0.4659764958, 
     -0.4713967368,  -0.4767992301,  -0.4821837721,  -0.4875501601, 
     -0.4928981922,  -0.4982276670,  -0.5035383837,  -0.5088301425, 
     -0.5141027442,  -0.5193559902,  -0.5245896827,  -0.5298036247, 
     -0.5349976199,  -0.5401714727,  -0.5453249884,  -0.5504579729, 
     -0.5555702330,  -0.5606615762,  -0.5657318108,  -0.5707807459, 
     -0.5758081914,  -0.5808139581,  -0.5857978575,  -0.5907597019, 
     -0.5956993045,  -0.6006164794,  -0.6055110414,  -0.6103828063, 
     -0.6152315906,  -0.6200572118,  -0.6248594881,  -0.6296382389, 
     -0.6343932842,  -0.6391244449,  -0.6438315429,  -0.6485144010, 
     -0.6531728430,  -0.6578066933,  -0.6624157776,  -0.6669999223, 
     -0.6715589548,  -0.6760927036,  -0.6806009978,  -0.6850836678, 
     -0.6895405447,  -0.6939714609,  -0.6983762494,  -0.7027547445, 
     -0.7071067812,  -0.7114321957,  -0.7157308253,  -0.7200025080, 
     -0.7242470830,  -0.7284643904,  -0.7326542717,  -0.7368165689, 
     -0.7409511254,  -0.7450577854,  -0.7491363945,  -0.7531867990, 
     -0.7572088465,  -0.7612023855,  -0.7651672656,  -0.7691033376, 
     -0.7730104534,  -0.7768884657,  -0.7807372286,  -0.7845565972, 
     -0.7883464276,  -0.7921065773,  -0.7958369046,  -0.7995372691, 
     -0.8032075315,  -0.8068475535,  -0.8104571983,  -0.8140363297, 
     -0.8175848132,  -0.8211025150,  -0.8245893028,  -0.8280450453, 
     -0.8314696123,  -0.8348628750,  -0.8382247056,  -0.8415549774, 
     -0.8448535652,  -0.8481203448,  -0.8513551931,  -0.8545579884, 
     -0.8577286100,  -0.8608669386,  -0.8639728561,  -0.8670462455, 
     -0.8700869911,  -0.8730949784,  -0.8760700942,  -0.8790122264, 
     -0.8819212643,  -0.8847970984,  -0.8876396204,  -0.8904487232, 
     -0.8932243012,  -0.8959662498,  -0.8986744657,  -0.9013488470, 
     -0.9039892931,  -0.9065957045,  -0.9091679831,  -0.9117060320, 
     -0.9142097557,  -0.9166790599,  -0.9191138517,  -0.9215140393, 
     -0.9238795325,  -0.9262102421,  -0.9285060805,  -0.9307669611, 
     -0.9329927988,  -0.9351835099,  -0.9373390119,  -0.9394592236, 
     -0.9415440652,  -0.9435934582,  -0.9456073254,  -0.9475855910, 
     -0.9495281806,  -0.9514350210,  -0.9533060404,  -0.9551411683, 
     -0.9569403357,  -0.9587034749,  -0.9604305194,  -0.9621214043, 
     -0.9637760658,  -0.9653944417,  -0.9669764710,  -0.9685220943, 
     -0.9700312532,  -0.9715038910,  -0.9729399522,  -0.9743393828, 
     -0.9757021300,  -0.9770281427,  -0.9783173707,  -0.9795697657, 
     -0.9807852804,  -0.9819638691,  -0.9831054874,  -0.9842100924, 
     -0.9852776424,  -0.9863080972,  -0.9873014182,  -0.9882575677, 
     -0.9891765100,  -0.9900582103,  -0.9909026354,  -0.9917097537, 
     -0.9924795346,  -0.9932119492,  -0.9939069700,  -0.9945645707, 
     -0.9951847267,  -0.9957674145,  -0.9963126122,  -0.9968202993, 
     -0.9972904567,  -0.9977230666,  -0.9981181129,  -0.9984755806, 
     -0.9987954562,  -0.9990777278,  -0.9993223846,  -0.9995294175, 
     -0.9996988187,  -0.9998305818,  -0.9999247018,  -0.9999811753, 
     -1.0000000000,  -0.9999811753,  -0.9999247018,  -0.9998305818, 
     -0.9996988187,  -0.9995294175,  -0.9993223846,  -0.9990777278, 
     -0.9987954562,  -0.9984755806,  -0.9981181129,  -0.9977230666, 
     -0.9972904567,  -0.9968202993,  -0.9963126122,  -0.9957674145, 
     -0.9951847267,  -0.9945645707,  -0.9939069700,  -0.9932119492, 
     -0.9924795346,  -0.9917097537,  -0.9909026354,  -0.9900582103, 
     -0.9891765100,  -0.9882575677,  -0.9873014182,  -0.9863080972, 
     -0.9852776424,  -0.9842100924,  -0.9831054874,  -0.9819638691, 
     -0.9807852804,  -0.9795697657,  -0.9783173707,  -0.9770281427, 
     -0.9757021300,  -0.9743393828,  -0.9729399522,  -0.9715038910, 
     -0.9700312532,  -0.9685220943,  -0.9669764710,  -0.9653944417, 
     -0.9637760658,  -0.9621214043,  -0.9604305194,  -0.9587034749, 
     -0.9569403357,  -0.9551411683,  -0.9533060404,  -0.9514350210, 
     -0.9495281806,  -0.9475855910,  -0.9456073254,  -0.9435934582, 
     -0.9415440652,  -0.9394592236,  -0.9373390119,  -0.9351835099, 
     -0.9329927988,  -0.9307669611,  -0.9285060805,  -0.9262102421, 
     -0.9238795325,  -0.9215140393,  -0.9191138517,  -0.9166790599, 
     -0.9142097557,  -0.9117060320,  -0.9091679831,  -0.9065957045, 
     -0.9039892931,  -0.9013488470,  -0.8986744657,  -0.8959662498, 
     -0.8932243012,  -0.8904487232,  -0.8876396204,  -0.8847970984, 
     -0.8819212643,  -0.8790122264,  -0.8760700942,  -0.8730949784, 
     -0.8700869911,  -0.8670462455,  -0.8639728561,  -0.8608669386, 
     -0.8577286100,  -0.8545579884,  -0.8513551931,  -0.8481203448, 
     -0.8448535652,  -0.8415549774,  -0.8382247056,  -0.8348628750, 
     -0.8314696123,  -0.8280450453,  -0.8245893028,  -0.8211025150, 
     -0.8175848132,  -0.8140363297,  -0.8104571983,  -0.8068475535, 
     -0.8032075315,  -0.7995372691,  -0.7958369046,  -0.7921065773, 
     -0.7883464276,  -0.7845565972,  -0.7807372286,  -0.7768884657, 
     -0.7730104534,  -0.7691033376,  -0.7651672656,  -0.7612023855, 
     -0.7572088465,  -0.7531867990,  -0.7491363945,  -0.7450577854, 
     -0.7409511254,  -0.7368165689,  -0.7326542717,  -0.7284643904, 
     -0.7242470830,  -0.7200025080,  -0.7157308253,  -0.7114321957, 
     -0.7071067812,  -0.7027547445,  -0.6983762494,  -0.6939714609, 
     -0.6895405447,  -0.6850836678,  -0.6806009978,  -0.6760927036, 
     -0.6715589548,  -0.6669999223,  -0.6624157776,  -0.6578066933, 
     -0.6531728430,  -0.6485144010,  -0.6438315429,  -0.6391244449, 
     -0.6343932842,  -0.6296382389,  -0.6248594881,  -0.6200572118, 
     -0.6152315906,  -0.6103828063,  -0.6055110414,  -0.6006164794, 
     -0.5956993045,  -0.5907597019,  -0.5857978575,  -0.5808139581, 
     -0.5758081914,  -0.5707807459,  -0.5657318108,  -0.5606615762, 
     -0.5555702330,  -0.5504579729,  -0.5453249884,  -0.5401714727, 
     -0.5349976199,  -0.5298036247,  -0.5245896827,  -0.5193559902, 
     -0.5141027442,  -0.5088301425,  -0.5035383837,  -0.4982276670, 
     -0.4928981922,  -0.4875501601,  -0.4821837721,  -0.4767992301, 
     -0.4713967368,  -0.4659764958,  -0.4605387110,  -0.4550835871, 
     -0.4496113297,  -0.4441221446,  -0.4386162385,  -0.4330938189, 
     -0.4275550934,  -0.4220002708,  -0.4164295601,  -0.4108431711, 
     -0.4052413140,  -0.3996241998,  -0.3939920401,  -0.3883450467, 
     -0.3826834324,  -0.3770074102,  -0.3713171940,  -0.3656129978, 
     -0.3598950365,  -0.3541635254,  -0.3484186802,  -0.3426607173, 
     -0.3368898534,  -0.3311063058,  -0.3253102922,  -0.3195020308, 
     -0.3136817404,  -0.3078496400,  -0.3020059493,  -0.2961508882, 
     -0.2902846773,  -0.2844075372,  -0.2785196894,  -0.2726213554, 
     -0.2667127575,  -0.2607941179,  -0.2548656596,  -0.2489276057, 
     -0.2429801799,  -0.2370236060,  -0.2310581083,  -0.2250839114, 
     -0.2191012402,  -0.2131103199,  -0.2071113762,  -0.2011046348, 
     -0.1950903220,  -0.1890686641,  -0.1830398880,  -0.1770042204, 
     -0.1709618888,  -0.1649131205,  -0.1588581433,  -0.1527971853, 
     -0.1467304745,  -0.1406582393,  -0.1345807085,  -0.1284981108, 
     -0.1224106752,  -0.1163186309,  -0.1102222073,  -0.1041216339, 
     -0.0980171403,  -0.0919089565,  -0.0857973123,  -0.0796824380, 
     -0.0735645636,  -0.0674439196,  -0.0613207363,  -0.0551952443, 
     -0.0490676743,  -0.0429382569,  -0.0368072229,  -0.0306748032, 
     -0.0245412285,  -0.0184067299,  -0.0122715383,  -0.0061358846, 
};

/* Normalize to between 0 and 2*PI */
float NormalizeAngle( float Angle )
{
	float FracAngle, NormAngle;
	int NumWraps;
/* Circle = 1.0 */
	FracAngle = Angle / PIx2;
	DBUG(("Angle = %f, FracAngle = %f\n", Angle, FracAngle ));
	NumWraps = (int) FracAngle;
/* Calc fractional part then scale back to 2PI */
	NormAngle = (FracAngle - ((float) NumWraps)) * PIx2;
/* Nudge into range. */
	DBUG(("NumWraps = %d, NormAngle = %f\n", NumWraps, NormAngle ));
	while(NormAngle < 0.0) NormAngle += PIx2;
	while(NormAngle >= (PIx2)) NormAngle -= PIx2;
	DBUG(("Final NormAngle = %f\n", NormAngle ));
	return NormAngle;
}

float LookupSin( float Angle )
{
	float FracAngle, NormAngle;
	int Index;
	NormAngle = NormalizeAngle( Angle );
	Index = (NormAngle * (float) NUM_SINE_ENTRIES) / PIx2;
	DBUG(("Index = %d\n", Index ));
	if( Index < 0 ) Index += NUM_SINE_ENTRIES;
	if( Index >= NUM_SINE_ENTRIES ) Index -= NUM_SINE_ENTRIES;
	return( gSineTable[Index] );
}

#define LookupCos(x) LookupSin(((x) + (PI/2.0)))

/* ATAN table. */
#define NUM_ATAN_ENTRIES 1025
#define ATAN_INPUT_RANGE (1.000000)
float gAtanTable[] =
{
  /*    0 */     0.0000000000,   0.0009756094,   0.0019512170,   0.0029268209, 
  /*    4 */     0.0039024192,   0.0048780101,   0.0058535917,   0.0068291621, 
  /*    8 */     0.0078047196,   0.0087802622,   0.0097557880,   0.0107312954, 
  /*   12 */     0.0117067822,   0.0126822469,   0.0136576873,   0.0146331018, 
  /*   16 */     0.0156084884,   0.0165838454,   0.0175591707,   0.0185344627, 
  /*   20 */     0.0195097194,   0.0204849390,   0.0214601196,   0.0224352594, 
  /*   24 */     0.0234103566,   0.0243854092,   0.0253604154,   0.0263353734, 
  /*   28 */     0.0273102813,   0.0282851373,   0.0292599396,   0.0302346862, 
  /*   32 */     0.0312093753,   0.0321840052,   0.0331585738,   0.0341330795, 
  /*   36 */     0.0351075203,   0.0360818944,   0.0370562000,   0.0380304352, 
  /*   40 */     0.0390045982,   0.0399786871,   0.0409527001,   0.0419266354, 
  /*   44 */     0.0429004911,   0.0438742654,   0.0448479564,   0.0458215624, 
  /*   48 */     0.0467950814,   0.0477685116,   0.0487418513,   0.0497150986, 
  /*   52 */     0.0506882516,   0.0516613085,   0.0526342675,   0.0536071268, 
  /*   56 */     0.0545798845,   0.0555525389,   0.0565250880,   0.0574975301, 
  /*   60 */     0.0584698633,   0.0594420859,   0.0604141960,   0.0613861918, 
  /*   64 */     0.0623580714,   0.0633298331,   0.0643014751,   0.0652729955, 
  /*   68 */     0.0662443925,   0.0672156643,   0.0681868092,   0.0691578252, 
  /*   72 */     0.0701287107,   0.0710994637,   0.0720700825,   0.0730405653, 
  /*   76 */     0.0740109103,   0.0749811157,   0.0759511797,   0.0769211005, 
  /*   80 */     0.0778908763,   0.0788605053,   0.0798299857,   0.0807993158, 
  /*   84 */     0.0817684937,   0.0827375177,   0.0837063860,   0.0846750968, 
  /*   88 */     0.0856436484,   0.0866120388,   0.0875802665,   0.0885483295, 
  /*   92 */     0.0895162262,   0.0904839548,   0.0914515134,   0.0924189003, 
  /*   96 */     0.0933861138,   0.0943531522,   0.0953200135,   0.0962866961, 
  /*  100 */     0.0972531983,   0.0982195182,   0.0991856541,   0.1001516043, 
  /*  104 */     0.1011173669,   0.1020829404,   0.1030483229,   0.1040135127, 
  /*  108 */     0.1049785080,   0.1059433071,   0.1069079083,   0.1078723098, 
  /*  112 */     0.1088365099,   0.1098005069,   0.1107642990,   0.1117278846, 
  /*  116 */     0.1126912618,   0.1136544291,   0.1146173846,   0.1155801266, 
  /*  120 */     0.1165426535,   0.1175049635,   0.1184670549,   0.1194289260, 
  /*  124 */     0.1203905751,   0.1213520006,   0.1223132006,   0.1232741735, 
  /*  128 */     0.1242349177,   0.1251954314,   0.1261557129,   0.1271157605, 
  /*  132 */     0.1280755727,   0.1290351476,   0.1299944836,   0.1309535790, 
  /*  136 */     0.1319124322,   0.1328710415,   0.1338294052,   0.1347875217, 
  /*  140 */     0.1357453892,   0.1367030062,   0.1376603709,   0.1386174818, 
  /*  144 */     0.1395743371,   0.1405309352,   0.1414872745,   0.1424433534, 
  /*  148 */     0.1433991701,   0.1443547231,   0.1453100106,   0.1462650312, 
  /*  152 */     0.1472197831,   0.1481742647,   0.1491284745,   0.1500824107, 
  /*  156 */     0.1510360717,   0.1519894561,   0.1529425620,   0.1538953880, 
  /*  160 */     0.1548479324,   0.1558001936,   0.1567521701,   0.1577038601, 
  /*  164 */     0.1586552622,   0.1596063747,   0.1605571961,   0.1615077247, 
  /*  168 */     0.1624579590,   0.1634078974,   0.1643575383,   0.1653068802, 
  /*  172 */     0.1662559215,   0.1672046606,   0.1681530960,   0.1691012260, 
  /*  176 */     0.1700490492,   0.1709965640,   0.1719437688,   0.1728906621, 
  /*  180 */     0.1738372423,   0.1747835080,   0.1757294575,   0.1766750894, 
  /*  184 */     0.1776204021,   0.1785653940,   0.1795100637,   0.1804544097, 
  /*  188 */     0.1813984303,   0.1823421242,   0.1832854897,   0.1842285255, 
  /*  192 */     0.1851712299,   0.1861136015,   0.1870556388,   0.1879973403, 
  /*  196 */     0.1889387045,   0.1898797299,   0.1908204151,   0.1917607585, 
  /*  200 */     0.1927007587,   0.1936404142,   0.1945797235,   0.1955186852, 
  /*  204 */     0.1964572978,   0.1973955598,   0.1983334699,   0.1992710265, 
  /*  208 */     0.2002082282,   0.2011450736,   0.2020815612,   0.2030176895, 
  /*  212 */     0.2039534572,   0.2048888628,   0.2058239049,   0.2067585821, 
  /*  216 */     0.2076928929,   0.2086268360,   0.2095604099,   0.2104936132, 
  /*  220 */     0.2114264445,   0.2123589024,   0.2132909855,   0.2142226925, 
  /*  224 */     0.2151540219,   0.2160849723,   0.2170155424,   0.2179457308, 
  /*  228 */     0.2188755361,   0.2198049570,   0.2207339920,   0.2216626398, 
  /*  232 */     0.2225908991,   0.2235187685,   0.2244462467,   0.2253733323, 
  /*  236 */     0.2263000239,   0.2272263202,   0.2281522200,   0.2290777218, 
  /*  240 */     0.2300028243,   0.2309275262,   0.2318518262,   0.2327757229, 
  /*  244 */     0.2336992152,   0.2346223015,   0.2355449807,   0.2364672515, 
  /*  248 */     0.2373891124,   0.2383105624,   0.2392316000,   0.2401522239, 
  /*  252 */     0.2410724330,   0.2419922259,   0.2429116013,   0.2438305580, 
  /*  256 */     0.2447490947,   0.2456672102,   0.2465849031,   0.2475021723, 
  /*  260 */     0.2484190165,   0.2493354345,   0.2502514249,   0.2511669866, 
  /*  264 */     0.2520821183,   0.2529968189,   0.2539110870,   0.2548249215, 
  /*  268 */     0.2557383212,   0.2566512847,   0.2575638110,   0.2584758988, 
  /*  272 */     0.2593875469,   0.2602987542,   0.2612095194,   0.2621198413, 
  /*  276 */     0.2630297187,   0.2639391506,   0.2648481356,   0.2657566727, 
  /*  280 */     0.2666647606,   0.2675723983,   0.2684795844,   0.2693863180, 
  /*  284 */     0.2702925978,   0.2711984227,   0.2721037915,   0.2730087031, 
  /*  288 */     0.2739131564,   0.2748171502,   0.2757206834,   0.2766237549, 
  /*  292 */     0.2775263636,   0.2784285084,   0.2793301881,   0.2802314016, 
  /*  296 */     0.2811321479,   0.2820324258,   0.2829322343,   0.2838315722, 
  /*  300 */     0.2847304385,   0.2856288321,   0.2865267520,   0.2874241969, 
  /*  304 */     0.2883211660,   0.2892176580,   0.2901136721,   0.2910092070, 
  /*  308 */     0.2919042618,   0.2927988354,   0.2936929267,   0.2945865348, 
  /*  312 */     0.2954796585,   0.2963722969,   0.2972644490,   0.2981561136, 
  /*  316 */     0.2990472899,   0.2999379767,   0.3008281731,   0.3017178781, 
  /*  320 */     0.3026070906,   0.3034958097,   0.3043840344,   0.3052717636, 
  /*  324 */     0.3061589965,   0.3070457320,   0.3079319692,   0.3088177070, 
  /*  328 */     0.3097029445,   0.3105876808,   0.3114719149,   0.3123556459, 
  /*  332 */     0.3132388727,   0.3141215944,   0.3150038102,   0.3158855190, 
  /*  336 */     0.3167667200,   0.3176474121,   0.3185275946,   0.3194072664, 
  /*  340 */     0.3202864266,   0.3211650744,   0.3220432088,   0.3229208289, 
  /*  344 */     0.3237979338,   0.3246745227,   0.3255505946,   0.3264261486, 
  /*  348 */     0.3273011839,   0.3281756996,   0.3290496948,   0.3299231687, 
  /*  352 */     0.3307961203,   0.3316685489,   0.3325404535,   0.3334118334, 
  /*  356 */     0.3342826876,   0.3351530153,   0.3360228157,   0.3368920879, 
  /*  360 */     0.3377608311,   0.3386290445,   0.3394967273,   0.3403638786, 
  /*  364 */     0.3412304977,   0.3420965837,   0.3429621357,   0.3438271531, 
  /*  368 */     0.3446916350,   0.3455555806,   0.3464189891,   0.3472818598, 
  /*  372 */     0.3481441918,   0.3490059844,   0.3498672368,   0.3507279482, 
  /*  376 */     0.3515881180,   0.3524477452,   0.3533068292,   0.3541653692, 
  /*  380 */     0.3550233645,   0.3558808142,   0.3567377178,   0.3575940744, 
  /*  384 */     0.3584498833,   0.3593051438,   0.3601598551,   0.3610140166, 
  /*  388 */     0.3618676275,   0.3627206871,   0.3635731947,   0.3644251496, 
  /*  392 */     0.3652765512,   0.3661273986,   0.3669776913,   0.3678274285, 
  /*  396 */     0.3686766096,   0.3695252338,   0.3703733005,   0.3712208091, 
  /*  400 */     0.3720677589,   0.3729141491,   0.3737599792,   0.3746052485, 
  /*  404 */     0.3754499564,   0.3762941021,   0.3771376851,   0.3779807048, 
  /*  408 */     0.3788231604,   0.3796650514,   0.3805063771,   0.3813471370, 
  /*  412 */     0.3821873303,   0.3830269566,   0.3838660151,   0.3847045053, 
  /*  416 */     0.3855424265,   0.3863797783,   0.3872165599,   0.3880527708, 
  /*  420 */     0.3888884105,   0.3897234782,   0.3905579736,   0.3913918959, 
  /*  424 */     0.3922252446,   0.3930580192,   0.3938902190,   0.3947218436, 
  /*  428 */     0.3955528924,   0.3963833648,   0.3972132603,   0.3980425783, 
  /*  432 */     0.3988713184,   0.3996994799,   0.4005270623,   0.4013540652, 
  /*  436 */     0.4021804880,   0.4030063301,   0.4038315911,   0.4046562705, 
  /*  440 */     0.4054803677,   0.4063038823,   0.4071268137,   0.4079491615, 
  /*  444 */     0.4087709252,   0.4095921042,   0.4104126981,   0.4112327065, 
  /*  448 */     0.4120521288,   0.4128709645,   0.4136892133,   0.4145068746, 
  /*  452 */     0.4153239480,   0.4161404330,   0.4169563292,   0.4177716361, 
  /*  456 */     0.4185863533,   0.4194004803,   0.4202140167,   0.4210269621, 
  /*  460 */     0.4218393161,   0.4226510782,   0.4234622479,   0.4242728249, 
  /*  464 */     0.4250828088,   0.4258921991,   0.4267009955,   0.4275091975, 
  /*  468 */     0.4283168048,   0.4291238169,   0.4299302334,   0.4307360540, 
  /*  472 */     0.4315412783,   0.4323459059,   0.4331499364,   0.4339533694, 
  /*  476 */     0.4347562046,   0.4355584416,   0.4363600801,   0.4371611196, 
  /*  480 */     0.4379615599,   0.4387614005,   0.4395606412,   0.4403592815, 
  /*  484 */     0.4411573212,   0.4419547599,   0.4427515973,   0.4435478330, 
  /*  488 */     0.4443434667,   0.4451384981,   0.4459329268,   0.4467267526, 
  /*  492 */     0.4475199752,   0.4483125941,   0.4491046092,   0.4498960201, 
  /*  496 */     0.4506868265,   0.4514770282,   0.4522666247,   0.4530556160, 
  /*  500 */     0.4538440015,   0.4546317812,   0.4554189546,   0.4562055216, 
  /*  504 */     0.4569914818,   0.4577768350,   0.4585615809,   0.4593457192, 
  /*  508 */     0.4601292498,   0.4609121723,   0.4616944865,   0.4624761921, 
  /*  512 */     0.4632572890,   0.4640377768,   0.4648176553,   0.4655969243, 
  /*  516 */     0.4663755835,   0.4671536328,   0.4679310719,   0.4687079006, 
  /*  520 */     0.4694841186,   0.4702597258,   0.4710347219,   0.4718091068, 
  /*  524 */     0.4725828801,   0.4733560418,   0.4741285917,   0.4749005294, 
  /*  528 */     0.4756718549,   0.4764425680,   0.4772126684,   0.4779821560, 
  /*  532 */     0.4787510306,   0.4795192920,   0.4802869401,   0.4810539746, 
  /*  536 */     0.4818203955,   0.4825862026,   0.4833513956,   0.4841159745, 
  /*  540 */     0.4848799391,   0.4856432892,   0.4864060247,   0.4871681454, 
  /*  544 */     0.4879296512,   0.4886905420,   0.4894508177,   0.4902104780, 
  /*  548 */     0.4909695229,   0.4917279522,   0.4924857659,   0.4932429637, 
  /*  552 */     0.4939995457,   0.4947555116,   0.4955108613,   0.4962655948, 
  /*  556 */     0.4970197120,   0.4977732127,   0.4985260968,   0.4992783643, 
  /*  560 */     0.5000300150,   0.5007810490,   0.5015314659,   0.5022812659, 
  /*  564 */     0.5030304488,   0.5037790145,   0.5045269630,   0.5052742941, 
  /*  568 */     0.5060210079,   0.5067671042,   0.5075125830,   0.5082574443, 
  /*  572 */     0.5090016879,   0.5097453138,   0.5104883219,   0.5112307123, 
  /*  576 */     0.5119724848,   0.5127136394,   0.5134541761,   0.5141940949, 
  /*  580 */     0.5149333956,   0.5156720783,   0.5164101430,   0.5171475895, 
  /*  584 */     0.5178844179,   0.5186206282,   0.5193562203,   0.5200911943, 
  /*  588 */     0.5208255501,   0.5215592876,   0.5222924070,   0.5230249081, 
  /*  592 */     0.5237567910,   0.5244880557,   0.5252187021,   0.5259487304, 
  /*  596 */     0.5266781404,   0.5274069323,   0.5281351060,   0.5288626614, 
  /*  600 */     0.5295895988,   0.5303159180,   0.5310416191,   0.5317667021, 
  /*  604 */     0.5324911670,   0.5332150140,   0.5339382429,   0.5346608539, 
  /*  608 */     0.5353828469,   0.5361042221,   0.5368249794,   0.5375451190, 
  /*  612 */     0.5382646408,   0.5389835449,   0.5397018314,   0.5404195003, 
  /*  616 */     0.5411365516,   0.5418529855,   0.5425688020,   0.5432840012, 
  /*  620 */     0.5439985831,   0.5447125477,   0.5454258953,   0.5461386258, 
  /*  624 */     0.5468507393,   0.5475622359,   0.5482731158,   0.5489833788, 
  /*  628 */     0.5496930253,   0.5504020551,   0.5511104686,   0.5518182656, 
  /*  632 */     0.5525254464,   0.5532320110,   0.5539379595,   0.5546432920, 
  /*  636 */     0.5553480087,   0.5560521096,   0.5567555949,   0.5574584646, 
  /*  640 */     0.5581607189,   0.5588623579,   0.5595633817,   0.5602637904, 
  /*  644 */     0.5609635841,   0.5616627631,   0.5623613273,   0.5630592770, 
  /*  648 */     0.5637566123,   0.5644533332,   0.5651494400,   0.5658449328, 
  /*  652 */     0.5665398116,   0.5672340768,   0.5679277283,   0.5686207663, 
  /*  656 */     0.5693131911,   0.5700050027,   0.5706962013,   0.5713867871, 
  /*  660 */     0.5720767601,   0.5727661207,   0.5734548688,   0.5741430048, 
  /*  664 */     0.5748305287,   0.5755174407,   0.5762037411,   0.5768894299, 
  /*  668 */     0.5775745073,   0.5782589735,   0.5789428288,   0.5796260732, 
  /*  672 */     0.5803087069,   0.5809907302,   0.5816721432,   0.5823529461, 
  /*  676 */     0.5830331391,   0.5837127224,   0.5843916962,   0.5850700606, 
  /*  680 */     0.5857478159,   0.5864249623,   0.5871014999,   0.5877774290, 
  /*  684 */     0.5884527498,   0.5891274625,   0.5898015672,   0.5904750642, 
  /*  688 */     0.5911479538,   0.5918202360,   0.5924919112,   0.5931629795, 
  /*  692 */     0.5938334413,   0.5945032966,   0.5951725457,   0.5958411888, 
  /*  696 */     0.5965092262,   0.5971766581,   0.5978434847,   0.5985097063, 
  /*  700 */     0.5991753230,   0.5998403351,   0.6005047429,   0.6011685466, 
  /*  704 */     0.6018317464,   0.6024943426,   0.6031563354,   0.6038177251, 
  /*  708 */     0.6044785118,   0.6051386959,   0.6057982776,   0.6064572571, 
  /*  712 */     0.6071156348,   0.6077734108,   0.6084305854,   0.6090871589, 
  /*  716 */     0.6097431315,   0.6103985035,   0.6110532752,   0.6117074468, 
  /*  720 */     0.6123610185,   0.6130139907,   0.6136663637,   0.6143181376, 
  /*  724 */     0.6149693127,   0.6156198894,   0.6162698679,   0.6169192485, 
  /*  728 */     0.6175680315,   0.6182162171,   0.6188638056,   0.6195107973, 
  /*  732 */     0.6201571925,   0.6208029915,   0.6214481945,   0.6220928019, 
  /*  736 */     0.6227368139,   0.6233802308,   0.6240230530,   0.6246652806, 
  /*  740 */     0.6253069141,   0.6259479537,   0.6265883997,   0.6272282524, 
  /*  744 */     0.6278675121,   0.6285061791,   0.6291442537,   0.6297817362, 
  /*  748 */     0.6304186270,   0.6310549262,   0.6316906343,   0.6323257516, 
  /*  752 */     0.6329602783,   0.6335942148,   0.6342275614,   0.6348603184, 
  /*  756 */     0.6354924860,   0.6361240648,   0.6367550549,   0.6373854566, 
  /*  760 */     0.6380152704,   0.6386444965,   0.6392731352,   0.6399011870, 
  /*  764 */     0.6405286520,   0.6411555306,   0.6417818232,   0.6424075301, 
  /*  768 */     0.6430326516,   0.6436571881,   0.6442811398,   0.6449045072, 
  /*  772 */     0.6455272906,   0.6461494902,   0.6467711065,   0.6473921397, 
  /*  776 */     0.6480125903,   0.6486324586,   0.6492517448,   0.6498704494, 
  /*  780 */     0.6504885727,   0.6511061151,   0.6517230768,   0.6523394583, 
  /*  784 */     0.6529552598,   0.6535704819,   0.6541851247,   0.6547991886, 
  /*  788 */     0.6554126741,   0.6560255814,   0.6566379110,   0.6572496631, 
  /*  792 */     0.6578608382,   0.6584714366,   0.6590814586,   0.6596909046, 
  /*  796 */     0.6602997751,   0.6609080702,   0.6615157905,   0.6621229363, 
  /*  800 */     0.6627295079,   0.6633355057,   0.6639409301,   0.6645457815, 
  /*  804 */     0.6651500602,   0.6657537666,   0.6663569010,   0.6669594639, 
  /*  808 */     0.6675614557,   0.6681628766,   0.6687637271,   0.6693640075, 
  /*  812 */     0.6699637183,   0.6705628598,   0.6711614324,   0.6717594364, 
  /*  816 */     0.6723568724,   0.6729537405,   0.6735500413,   0.6741457751, 
  /*  820 */     0.6747409422,   0.6753355432,   0.6759295783,   0.6765230480, 
  /*  824 */     0.6771159526,   0.6777082926,   0.6783000683,   0.6788912801, 
  /*  828 */     0.6794819284,   0.6800720136,   0.6806615362,   0.6812504964, 
  /*  832 */     0.6818388947,   0.6824267315,   0.6830140072,   0.6836007222, 
  /*  836 */     0.6841868769,   0.6847724716,   0.6853575069,   0.6859419830, 
  /*  840 */     0.6865259004,   0.6871092596,   0.6876920608,   0.6882743045, 
  /*  844 */     0.6888559911,   0.6894371210,   0.6900176947,   0.6905977125, 
  /*  848 */     0.6911771748,   0.6917560821,   0.6923344347,   0.6929122331, 
  /*  852 */     0.6934894776,   0.6940661688,   0.6946423069,   0.6952178925, 
  /*  856 */     0.6957929259,   0.6963674075,   0.6969413378,   0.6975147171, 
  /*  860 */     0.6980875460,   0.6986598247,   0.6992315538,   0.6998027336, 
  /*  864 */     0.7003733646,   0.7009434472,   0.7015129817,   0.7020819687, 
  /*  868 */     0.7026504085,   0.7032183016,   0.7037856484,   0.7043524493, 
  /*  872 */     0.7049187047,   0.7054844151,   0.7060495808,   0.7066142024, 
  /*  876 */     0.7071782802,   0.7077418147,   0.7083048063,   0.7088672553, 
  /*  880 */     0.7094291624,   0.7099905278,   0.7105513520,   0.7111116354, 
  /*  884 */     0.7116713785,   0.7122305817,   0.7127892454,   0.7133473701, 
  /*  888 */     0.7139049562,   0.7144620041,   0.7150185143,   0.7155744871, 
  /*  892 */     0.7161299231,   0.7166848226,   0.7172391862,   0.7177930142, 
  /*  896 */     0.7183463070,   0.7188990652,   0.7194512891,   0.7200029791, 
  /*  900 */     0.7205541358,   0.7211047596,   0.7216548509,   0.7222044101, 
  /*  904 */     0.7227534376,   0.7233019340,   0.7238498997,   0.7243973350, 
  /*  908 */     0.7249442405,   0.7254906166,   0.7260364637,   0.7265817823, 
  /*  912 */     0.7271265728,   0.7276708357,   0.7282145714,   0.7287577803, 
  /*  916 */     0.7293004629,   0.7298426196,   0.7303842509,   0.7309253573, 
  /*  920 */     0.7314659391,   0.7320059968,   0.7325455309,   0.7330845419, 
  /*  924 */     0.7336230301,   0.7341609960,   0.7346984401,   0.7352353628, 
  /*  928 */     0.7357717645,   0.7363076458,   0.7368430070,   0.7373778486, 
  /*  932 */     0.7379121711,   0.7384459749,   0.7389792604,   0.7395120282, 
  /*  936 */     0.7400442786,   0.7405760122,   0.7411072293,   0.7416379304, 
  /*  940 */     0.7421681161,   0.7426977866,   0.7432269425,   0.7437555843, 
  /*  944 */     0.7442837124,   0.7448113271,   0.7453384291,   0.7458650188, 
  /*  948 */     0.7463910966,   0.7469166629,   0.7474417182,   0.7479662630, 
  /*  952 */     0.7484902978,   0.7490138229,   0.7495368389,   0.7500593461, 
  /*  956 */     0.7505813452,   0.7511028364,   0.7516238203,   0.7521442974, 
  /*  960 */     0.7526642680,   0.7531837327,   0.7537026919,   0.7542211460, 
  /*  964 */     0.7547390956,   0.7552565410,   0.7557734828,   0.7562899214, 
  /*  968 */     0.7568058572,   0.7573212907,   0.7578362225,   0.7583506528, 
  /*  972 */     0.7588645823,   0.7593780113,   0.7598909403,   0.7604033698, 
  /*  976 */     0.7609153002,   0.7614267320,   0.7619376657,   0.7624481017, 
  /*  980 */     0.7629580405,   0.7634674826,   0.7639764283,   0.7644848782, 
  /*  984 */     0.7649928327,   0.7655002923,   0.7660072575,   0.7665137287, 
  /*  988 */     0.7670197063,   0.7675251909,   0.7680301829,   0.7685346827, 
  /*  992 */     0.7690386909,   0.7695422079,   0.7700452341,   0.7705477700, 
  /*  996 */     0.7710498161,   0.7715513729,   0.7720524407,   0.7725530201, 
  /* 1000 */     0.7730531116,   0.7735527155,   0.7740518324,   0.7745504627, 
  /* 1004 */     0.7750486069,   0.7755462654,   0.7760434387,   0.7765401274, 
  /* 1008 */     0.7770363317,   0.7775320523,   0.7780272895,   0.7785220439, 
  /* 1012 */     0.7790163158,   0.7795101058,   0.7800034144,   0.7804962419, 
  /* 1016 */     0.7809885888,   0.7814804557,   0.7819718430,   0.7824627511, 
  /* 1020 */     0.7829531805,   0.7834431317,   0.7839326051,   0.7844216012, 
  /* 1024 */     0.7849101205,   0.7853981634,   0.7858857304,   0.7863728220, 
};

float LookupAtan2( float fA, float fB )
{
	int32 Index;
	float fAp, fBp;
	float Ratio, xat;

	if( (fA == fB) && (fA == 0.0) ) return 0.0;

	
	if ( fA < 0.0 )
	{
		fAp = 0.0 - fA;
	}
	else
	{
		fAp = fA;
	}
	if ( fB < 0.0 )
	{
		fBp = 0.0 - fB;
	}
	else
	{
		fBp = fB;
	}
#if 0
/* This didn't compile right! */
	fBp = ( fB < 0.0 ) ? (0.0 - fB) : fB ;
#endif
DBUG(("fAp = %f, fBp = %f, Ratio = %f\n", fAp, fBp, Ratio ));
	Ratio = ( fAp < fBp ) ? (fAp / fBp) : (fBp / fAp);
DBUG(("fAp = %f, fBp = %f, Ratio = %f\n", fAp, fBp, Ratio ));
	Index = Ratio * ((float) NUM_ATAN_ENTRIES);

	xat = gAtanTable[Index];
DBUG(("xat = %f\n", xat));
	if( fAp > fBp ) xat = (PI/2.0) - xat;
DBUG(("xat = %f\n", xat));
	if( fB < 0.0 ) xat = PI - xat;
DBUG(("xat = %f\n", xat));
	if( fA < 0.0 ) xat = PIx2 - xat;
DBUG(("xat = %f\n", xat));
	return xat;
}
/*******************************************************************/
/*************** Graphics Display***********************************/
/*******************************************************************/

GrafCon gc;
int32 ScreenPages;
int32 gDrawToScreen;   /* 0 or 1 */

#define NBUFFERS 2

Item ScreenItems[NBUFFERS], ScreenGroupItem, BitmapItems[NBUFFERS];
Bitmap *Bitmaps[NBUFFERS];

#define SCREEN_WIDTH    (320)
#define SCREEN_HEIGHT   (240)
TagArg ScreenTags[] = {
  CSG_TAG_DISPLAYHEIGHT,(void*)SCREEN_HEIGHT,
  CSG_TAG_SCREENCOUNT,	(void*)NBUFFERS,
  CSG_TAG_SCREENHEIGHT,	(void*)SCREEN_HEIGHT,
  CSG_TAG_DONE,		(void*)0,
};

void
terminate (int32 i)
{
  if (i<0) {
    PrintfSysErr (i);
  }
  exit (i);
}

/* Switch between double buffered screens. */
void e3SwitchScreens( void )
{
	DisplayScreen (ScreenItems[gDrawToScreen], ScreenItems[gDrawToScreen]);
	gDrawToScreen = (gDrawToScreen == 1) ? 0 : 1 ;
	DBUG(("gDrawToScreen = %d\n", gDrawToScreen));
/* Erase screen we're about to draw into. */
	memset (Bitmaps[gDrawToScreen]->bm_Buffer, 0, ScreenPages*GrafBase->gf_VRAMPageSize);
}

e3InitGraphics( void )
{
	int32 i;
	DBUG (("Open graphics folio\n"));
	if ((i=OpenGraphicsFolio()) < 0) {
		DBUG (("Error - unable to open graphics folio (%08lx)\n", i));
		terminate (i);
	}

	DBUG (("Create screen group\n"));
	ScreenGroupItem = CreateScreenGroup (ScreenItems, ScreenTags);
	if (ScreenGroupItem<0) {
    		DBUG (("Error: CreateScreenGroup() == %lx\n", ScreenGroupItem));
		terminate (ScreenGroupItem);
	}
	DBUG (("Add screen group\n"));
	AddScreenGroup (ScreenGroupItem, NULL);

	for (i=0; i<NBUFFERS; i++)
	{
		Screen *screen;
		screen = (Screen*)LookupItem (ScreenItems[i]);
		if (screen==0) {
		  DBUG (("Error: could not locate screen\n"));
		  terminate (1);
		}
	BitmapItems[i] = screen->scr_TempBitmap->bm.n_Item;
	Bitmaps[i] = screen->scr_TempBitmap;
	DBUG (("Screen[%d] buffer @ %08lx\n", i, Bitmaps[i]->bm_Buffer));
	}

	ScreenPages = (Bitmaps[0]->bm_Width*Bitmaps[0]->bm_Height*2
		+GrafBase->gf_VRAMPageSize-1) / GrafBase->gf_VRAMPageSize;

	gDrawToScreen = 0;
	e3SwitchScreens();

	return 0;
 }

drawline (int32 x1, int32 y1, int32 x2, int32 y2, int32 color)
{
  SetFGPen (&gc, color);
  MoveTo (&gc, x1, y1);
  DrawTo (BitmapItems[gDrawToScreen], &gc, x2, y2);
}

/*******************************************************************/
/*************** Plane Control *************************************/
/*******************************************************************/

typedef struct PlaneCharacteristics
{
	float    plch_ViscousDragCoefficient;
	float    plch_TurbulentDragCoefficient;
	float    plch_LiftCoefficient;
	float    plch_ZeroLiftAngle;     /* AngleToWind at which there is no lift. */
	float    plch_Mass;              /* Kilograms */
} PlaneCharacteristics;

typedef struct PlaneStatus
{
	float    plst_XPos;
	float    plst_YPos;
	float    plst_Altitude;
	float    plst_Yaw;         /* Compass angle. 0 is East along X axis. */
	float    plst_YawDelta;    /* Rotational velocity */
	float    plst_Pitch;       /* Angle of nose to horizon. */
	float    plst_PitchDelta;  /* Rotational velocity */
	float    plst_Roll;        /* Angle about central axis. */
	float    plst_RollDelta;   /* Rotational velocity */
	float    plst_Throttle;
	float    plst_HorizontalVelocity;
	float    plst_VerticalVelocity;
	float    plst_AirVelocity;   /* Derived from H & V velocity */
} PlaneStatus;

/* Assume basic time unit is one display frame period. */
#define FRAME_RATE         (15)
#define E3_TIME_UNIT       (1.0/((float) FRAME_RATE))
/* g = 9.8 m/(sec**2) */
#define GRAVITY_ACCELERATION   (9.8 * (E3_TIME_UNIT * E3_TIME_UNIT))

/* Define plane characteristics. */
/* Max Velocity in meters/E3_TIME_UNIT. This corresponds roughly to 200 miles/hour */
#define MAX_VELOCITY    (100.0 * E3_TIME_UNIT)
#define PLANE_MASS    (600.0)
#define GRAVITATIONAL_FORCE  (PLANE_MASS * GRAVITY_ACCELERATION)
/* Planes engine can only generate a fraction of thrust needed to climb straight up. */
#define MAX_THRUST    (GRAVITATIONAL_FORCE / 2.0)
/* Vertical Crash Velocity in meters/E3_TIME_UNIT. This corresponds roughly to 5 miles/hour */
#define CRASH_VELOCITY   (-(5.0 * E3_TIME_UNIT))
#define ZERO_LIFT_ANGLE  (-0.2)

/****************************************************************/
int32	e3InitPlane( PlaneStatus *plst, PlaneCharacteristics *plch )
{
	memset( plst, 0, sizeof(PlaneStatus) );

/* Based on equation:   drag(maxvel) = maxthrust */
	plch->plch_ViscousDragCoefficient = MAX_THRUST /
		(MAX_VELOCITY * (1.0 + (MAX_VELOCITY/2.0)));
	plch->plch_TurbulentDragCoefficient = plch->plch_ViscousDragCoefficient / 2.0;

/* Base lift coefficient on having sufficient lift to fly at 70% max velocity. */
	plch->plch_ZeroLiftAngle = ZERO_LIFT_ANGLE;
	plch->plch_LiftCoefficient = GRAVITATIONAL_FORCE / 
		((MAX_VELOCITY * 0.7) * LookupSin(0.0 - plch->plch_ZeroLiftAngle));
	plch->plch_Mass = PLANE_MASS;
}

#define YAW_INCR  (PIx2/100.0)
#define PITCH_INCR  (PIx2/60.0)
#define ROLL_INCR  (PIx2/60.0)
#define THROTTLE_INCR  (MAX_THRUST / (3.0*FRAME_RATE))
#define DECAY_FACTOR   (0.9)

#define YAW_DELTA_FILTER_COEFF (0.80)
#define PITCH_DELTA_FILTER_COEFF (0.85)
#define ROLL_DELTA_FILTER_COEFF (0.90)
/****************************************************************/
int32	e3ControlPlane( uint32 ButtonBits, PlaneStatus *plst )
{
	float TempDelta;

/* Apply buttons to motion. */
/* YAW --------------------------------------------------- YAW */
	if( ButtonBits & ControlLeft )
	{
		TempDelta = YAW_INCR;
	}
	else if( ButtonBits & ControlRight )
	{
		TempDelta = -(YAW_INCR);
	}
	else
	{
		TempDelta = 0.0;
	}
/* Low pass filter YawDelta and apply to Yaw */
	plst->plst_YawDelta = (YAW_DELTA_FILTER_COEFF * plst->plst_YawDelta)
		+ ((1.0 - YAW_DELTA_FILTER_COEFF) * TempDelta );
	plst->plst_Yaw += plst->plst_YawDelta;
/* Wrap Yaw */
	while( plst->plst_Yaw > PIx2 ) plst->plst_Yaw -= PIx2;
	while( plst->plst_Yaw < 0.0 ) plst->plst_Yaw += PIx2;


/* PITCH ----------------------------------------------- PITCH */
	TempDelta = 0.0;
/* Don't allow plane to change pitch until airborn. */
	if( plst->plst_Altitude > 1.0 )
	{
		if( ButtonBits & ControlUp )
		{
			TempDelta = -(PITCH_INCR);
		}
		else if( ButtonBits & ControlDown )
		{
			TempDelta = PITCH_INCR;
		}
/* Low pass filter PitchDelta and apply to Pitch */
		plst->plst_PitchDelta = (PITCH_DELTA_FILTER_COEFF * plst->plst_PitchDelta)
		+ ((1.0 - PITCH_DELTA_FILTER_COEFF) * TempDelta );
		plst->plst_Pitch += plst->plst_PitchDelta;
	}
/* Return plane to level when hand off stick. */
	plst->plst_Pitch = plst->plst_Pitch * DECAY_FACTOR;

/* ROLL ------------------------------------------------ ROLL */
	if( ButtonBits & ControlLeftShift )
	{
		TempDelta = -(ROLL_INCR);
	}
	else if( ButtonBits & ControlRightShift )
	{
		TempDelta = ROLL_INCR;
	}
	else
	{
		TempDelta = 0.0;
	}
/* Low pass filter RollDelta and apply to Roll */
	plst->plst_RollDelta = (ROLL_DELTA_FILTER_COEFF * plst->plst_RollDelta)
		+ ((1.0 - ROLL_DELTA_FILTER_COEFF) * TempDelta );
	plst->plst_Roll += plst->plst_RollDelta;
	plst->plst_Roll = plst->plst_Roll * DECAY_FACTOR;

/* Throttle or brake. */
	if( ButtonBits & ControlA )
	{
		plst->plst_Throttle += THROTTLE_INCR;
		if( plst->plst_Throttle > MAX_THRUST ) plst->plst_Throttle = MAX_THRUST;
	}
	if( ButtonBits & ControlB )
	{
		plst->plst_Throttle -= THROTTLE_INCR;
		if( plst->plst_Throttle < 0.0 ) plst->plst_Throttle = 0.0;
/* Brake hard on ground. */
		if( plst->plst_Altitude < 1.0 )
		{
			plst->plst_HorizontalVelocity *= 0.9;
		}
	}
}


void e3PlotForce( float HorizontalComponent, float VerticalComponent, int32 color )
{
	int32 x1, y1, x2, y2;

	x1 = 220;
	y1 = SCREEN_HEIGHT/2;
	x2 = x1 + ((int32) (HorizontalComponent * 2.0));
	y2 = y1 - ((int32) (VerticalComponent * 2.0));
	DBUG(("e3PlotForce: %d, %d, %d, %d\n", x1, y1, x2, y2 ));
	drawline ( x1, y1, x2, y2, color);
}

/****************************************************************/
int32	e3DoPlanePhysics( PlaneStatus *plst, PlaneCharacteristics *plch )
{
	float LiftForce;
	float DragForce;
	float ThrustForce;
	float GravityForce;
	float CombinedForce;
	float VerticalComponent;   /* Positive Force is up. */
	float HorizontalComponent; /* Positive Force is forward. */
	float VerticalForce;   /* Positive Force is up. */
	float HorizontalForce; /* Positive Force is forward. */
	float CosPitch;
	float SinPitch;
	float AngleOfTravel;   /* Angle to horizon plane is actually travelling. */
	float CosTravel;
	float SinTravel;
	float AngleToWind;   /* Angle to plane direction of travel. */
	int32 Result;

DBUG(("--------------------------------------------\n" ));
/* Calculate Pitch sin/cos once */
	CosPitch = LookupCos( plst->plst_Pitch );
	SinPitch = LookupSin( plst->plst_Pitch );

/* Calculate AirSpeed using Pythagorean theorem. */
	plst->plst_AirVelocity = sqrt(
		(plst->plst_HorizontalVelocity * plst->plst_HorizontalVelocity) +
		(plst->plst_VerticalVelocity * plst->plst_VerticalVelocity) );

/* Calculate angle of travel to horizon. */
	if( (plst->plst_HorizontalVelocity < 1.0) && (plst->plst_HorizontalVelocity > -1.0) )
	{
		AngleOfTravel = 0.0;
	}
	else
	{
		AngleOfTravel = LookupAtan2( plst->plst_VerticalVelocity, plst->plst_HorizontalVelocity );
	}

	CosTravel = LookupCos( AngleOfTravel );
	SinTravel = LookupSin( AngleOfTravel );
	AngleToWind = plst->plst_Pitch - AngleOfTravel;
DBUG(("Pitch = %g, AngleOfTravel = %g, AngleToWind = %g\n", plst->plst_Pitch, AngleOfTravel, AngleToWind ));

/* Calculate DRAG forces along angle of travel. */
/* Drag = R(v) = Av + Bvv = (A + Bv)v */
	DragForce = ((plch->plch_TurbulentDragCoefficient * plst->plst_AirVelocity) +
		plch->plch_ViscousDragCoefficient) * plst->plst_AirVelocity;
/* Project Force along Vertical and Horizontal axes */
	VerticalComponent = -1.0 * SinTravel * DragForce;
	HorizontalComponent = -1.0 * CosTravel * DragForce;
	e3PlotForce( HorizontalComponent, VerticalComponent, MakeRGB15(15,0,0));
	VerticalForce = VerticalComponent;
	HorizontalForce = HorizontalComponent;

/* Simplistic model. THRUST=Throttle along axis of plane. */
	ThrustForce = plst->plst_Throttle;
	VerticalComponent = SinPitch * ThrustForce;
	HorizontalComponent = CosPitch * ThrustForce;
	e3PlotForce( HorizontalComponent, VerticalComponent, MakeRGB15(15,15,0));
	VerticalForce += VerticalComponent;
	HorizontalForce += HorizontalComponent;
DBUG(("Thrust = %g, Drag = %g\n", ThrustForce, DragForce ));

/* Calculate LIFT Normal to plane and project. */
	LiftForce = plch->plch_LiftCoefficient * plst->plst_AirVelocity *
		LookupSin(AngleToWind - plch->plch_ZeroLiftAngle);
	VerticalComponent = CosPitch * LiftForce;
	HorizontalComponent = -1.0 * (SinPitch * LiftForce);
	e3PlotForce( HorizontalComponent, VerticalComponent, MakeRGB15(8,0,15));
	VerticalForce += VerticalComponent;
	HorizontalForce += HorizontalComponent;
	
/* Apply GRAVITY only to Vertical Force */
	GravityForce = plch->plch_Mass * GRAVITY_ACCELERATION;
	VerticalComponent = -1.0 * GravityForce;
	HorizontalComponent = 0.0;
	e3PlotForce( HorizontalComponent, VerticalComponent, MakeRGB15(4,15,2));
	VerticalForce += VerticalComponent;
	HorizontalForce += HorizontalComponent;
DBUG(("Gravity = %g, Lift = %g\n", GravityForce, LiftForce ));

/* Change velocities based on forces. */
	plst->plst_HorizontalVelocity += HorizontalForce / plch->plch_Mass;
	plst->plst_VerticalVelocity += VerticalForce / plch->plch_Mass;
DBUG(("HVel = %g, VVel = %g\n", plst->plst_HorizontalVelocity, plst->plst_VerticalVelocity ));

/* Calculate new position based on velocities. */
	plst->plst_XPos += LookupCos( plst->plst_Yaw ) * plst->plst_HorizontalVelocity;
	plst->plst_YPos += LookupSin( plst->plst_Yaw ) * plst->plst_HorizontalVelocity;
	plst->plst_Altitude += plst->plst_VerticalVelocity;

/* Check for Crash */
	Result = 0;
	if( plst->plst_Altitude < 0.0 )
	{
		if( plst->plst_VerticalVelocity < CRASH_VELOCITY )
		{
			Result = -1;
		}
		plst->plst_Altitude = 0.0;
		plst->plst_VerticalVelocity = 0.0;
	}

	return Result;
}

/****************************************************************/
int32	e3ReportPlane( PlaneStatus *plst )
{
	PRT(("Yaw = %f, Pitch = %g, Roll = %g\n",
		plst->plst_Yaw,
		plst->plst_Pitch,
		plst->plst_Roll ));
}

/****************************************************************/

void e3DisplayAngle( float Angle, int32 xCenter, int32 yCenter, int32 Radius )
{
	int32 x1, y1, x2, y2, color;
	int32 yd, xd;

/* Draw BackGround */
	color = 0x041F;
	drawline( xCenter-Radius, yCenter-Radius, xCenter+Radius, yCenter-Radius, color );
	drawline( xCenter+Radius, yCenter-Radius, xCenter+Radius, yCenter+Radius, color );
	drawline( xCenter+Radius, yCenter+Radius, xCenter-Radius, yCenter+Radius, color );
	drawline( xCenter-Radius, yCenter+Radius, xCenter-Radius, yCenter-Radius, color );

/* Draw needle. */
	xd = (int32) (LookupCos( Angle ) * Radius);
	yd = (int32) (LookupSin( Angle ) * Radius);
	color = 0x7FF0;
	drawline (xCenter, yCenter, xCenter + xd, yCenter - yd, color);
}

/****************************************************************/

void e3DisplayValue( float Value, float MaxValue, int32 xCenter, int32 yTop, int32 yBottom )
{
	int32 y, color;

/* Draw BackGround */
	color = 0x041F;
	drawline( xCenter, yBottom, xCenter, yTop, color );

/* Draw needle. */
	y = yBottom - ((int32) (Value * ((float)(yBottom - yTop))/ MaxValue));
	color = 0x7FF0;
	drawline (xCenter-10, y, xCenter+10, y, color);
}

/****************************************************************/
void e3DisplayPlaneStatus( PlaneStatus *plst )
{
#define DPS_RADIUS  (30)
	int32 xc, yc;

	xc = 120;
	yc = DPS_RADIUS + 10;
	e3DisplayAngle( plst->plst_Yaw, xc, yc, 30 );
	yc += (DPS_RADIUS*2) + 10;
	e3DisplayAngle( plst->plst_Pitch, xc, yc, 30 );
	yc += (DPS_RADIUS*2) + 10;
	e3DisplayAngle( plst->plst_Roll, xc, yc, 30 );

	e3DisplayValue( plst->plst_Altitude, 400.0, 40, 20, 200 );
	e3DisplayValue( plst->plst_AirVelocity, (MAX_VELOCITY * 2.0), 70, 20, 200 );
}

/****************************************************************/
void CheckTrig( void )
{
	printf("\nsqrt(49.0) = %f\n", sqrt(49.0) );
	printf("\nsqrt(2.0) = %f\n", sqrt(2.0) );

	printf("\nLookupAtan2(0.0, 0.0) = %f\n", LookupAtan2(0.0, 0.0) );
	printf("LookupAtan2(2.0,3.0) = %f\n", LookupAtan2(2.0,3.0) );
	printf("LookupAtan2(-2.0,3.0) = %f\n", LookupAtan2(-2.0,3.0) );
	printf("LookupAtan2(2.0,-3.0) = %f\n", LookupAtan2(2.0,-3.0) );
	printf("LookupAtan2(-2.0,-3.0) = %f\n", LookupAtan2(-2.0,-3.0) );

	printf("LookupAtan2(3.0,2.0) = %f\n", LookupAtan2(3.0,2.0) );
	printf("LookupAtan2(-3.0,2.0) = %f\n", LookupAtan2(-3.0,2.0) );
	printf("LookupAtan2(3.0,-2.0) = %f\n", LookupAtan2(3.0,-2.0) );
	printf("LookupAtan2(-3.0,-2.0) = %f\n", LookupAtan2(-3.0,-2.0) );

	printf("LookupAtan2(2.0,2.0) = %f\n", LookupAtan2(2.0,2.0) );

	printf("\nLookupCos(0.0) = %f\n", LookupCos(0.0) );
	printf(" LookupSin(0.0) = %f\n", LookupSin(0.0) );
	printf(" LookupCos(3.14159265/4.0) = %f\n", LookupCos(3.14159265/4.0) );
	printf(" LookupSin(3.14159265/4.0) = %f\n", LookupSin(3.14159265/4.0) );
	printf(" LookupCos(3.14159265/2.0) = %f\n", LookupCos(3.14159265/2.0) );
	printf(" LookupSin(3.14159265/2.0) = %f\n", LookupSin(3.14159265/2.0) );
}

/****************************************************************/
int main(int32 argc, char **argv)
{
	Err                 err;
	ControlPadEventData cp;
	int32  Result;

	PlaneStatus myPlaneStatus;
	PlaneCharacteristics myPlaneCharacteristics;

	printf("Initializing event utility\n");

	err = InitEventUtility(1, 0, TRUE);
	if (err < 0)
	{
		printf("Unable to initialize the event utility: ");
		PrintfSysErr(err);
		return 0;
	}

	err = OpenAudioFolio();
	if (err < 0)
	{
		printf("Unable to OpenAudioFolio");
		PrintfSysErr(err);
        	return 0;
    	}

/*	CheckTrig(); */

	e3InitGraphics( );
	e3InitPlane( &myPlaneStatus, &myPlaneCharacteristics );
	do
	{
		PRT(("GetAudioTime = %d\n", GetAudioTime() ));
		err = GetControlPad (1, FALSE, &cp);
		if (err < 0)
		{
			printf("GetControlPad() failed: ");
			PrintfSysErr(err);
			break;
		}

		e3ControlPlane( cp.cped_ButtonBits, &myPlaneStatus );
		Result = e3DoPlanePhysics( &myPlaneStatus, &myPlaneCharacteristics );
		if( Result < 0 )
		{
			PRT(("------=< CRASH >=--------\n"));
			goto byebye;
		}
/*		e3ReportPlane( &myPlaneStatus ); */
		e3DisplayPlaneStatus( &myPlaneStatus );
		e3SwitchScreens();

		DBUG(("Control pad 1: update %d, bits 0x%x\n", err, cp.cped_ButtonBits));
	}
	while ((cp.cped_ButtonBits & ControlStart) == 0);

byebye:
	printf("Shutting down demo\n");

	KillEventUtility();

	return 0;
}
